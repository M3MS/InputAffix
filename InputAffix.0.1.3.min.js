"use strict";
// Created by Juan Camilo Osorio (JCOC611 - jcoc611.com).
// Version 0.1.3. (Beta).
// Consider giving back by sharing your own code!
// Licensed under the MIT License. 
// http://www.opensource.org/licenses/mit-license.php

// Includes jQuery Caret v1.02
// Slightly modified by JCOC611.
// Created by C. F., Wong, and also licensed
// under the MIT License. Find his project here:
// https://code.google.com/p/jcaret/ 

!function(t){if(!t)throw new Error("Input Affix: no jQuery found. Make sure window.jQuery exists.");t.fn.caret=function(t,e){var n,a,r=this[0];if("object"==typeof t&&"number"==typeof t.start&&"number"==typeof t.end)n=t.start,a=t.end;else if("number"==typeof t&&"number"==typeof e)n=t,a=e;else if("string"==typeof t)(n=r.value.indexOf(t))>-1?a=n+t.length:n=null;else if("[object RegExp]"===Object.prototype.toString.call(t)){var s=t.exec(r.value);null!=s&&(n=s.index,a=n+s[0].length)}if("undefined"!=typeof n){if(r.createTextRange){var h=r.createTextRange();h.collapse(!0),h.moveStart("character",n),h.moveEnd("character",a-n),h.select()}else r.selectionStart=n,r.selectionEnd=a;return r.focus(),this}if(document.selection){var i=document.selection;if("textarea"!=r.tagName.toLowerCase()){var l=this.val(),f=i.createRange().duplicate();f.moveEnd("character",l.length);var g=""==f.text?l.length:l.lastIndexOf(f.text);f=i.createRange().duplicate(),f.moveStart("character",-l.length);var u=f.text.length}else{var f=i.createRange(),d=f.duplicate();d.moveToElementText(r),d.setEndPoint("EndToEnd",f);var g=d.text.length-f.text.length,u=g+f.text.length}}else var g=r.selectionStart,u=r.selectionEnd;var v=r.value.substring(g,u);return{start:g,end:u,text:v,replace:function(t){return r.value.substring(0,g)+t+r.value.substring(u,r.value.length)}}},t.fn.affixValue=function(t){if(void 0===t){t=this.val();var e=this.data("prefix"),n=this.data("suffix");return e&&t.substr(0,e.length)==e&&(t=t.substr(this.data("prefix"))),n&&t.substr(t.length-n.length)==n&&(t=t.substr(0,t.length-n.length)),t}return t+="",this.data("prefix")&&(t=this.data("prefix")+t),this.data("suffix")&&(t+=this.data("suffix")),this.val(t),this},t.fn.prefix=function(e,n){if(void 0===e)return this.data("prefix");var a=this.val(),r=this.data("prefix");return r&&a.substr(0,r.length)==r&&this.val(a.substr(r.length,a.length-r.length)),"object"==typeof e?(this.data("prefix-list",e),n=n||0,e=e[n]):"number"==typeof e&&this.data("prefix-list")?(n=e,e=this.data("prefix-list")[n]):this.data("prefix-list",!1),this.data("prefix",e),this.trigger("prefixchange",[e,n||0]),0!=this.val().indexOf(e)&&this.val(e+this.val()),this.on("keypress",function(n){var a=t(this),r=a.caret(),s=a.data("prefix"),h=a.val();if(!n.ctrlKey&&r.start<s.length){var i=a.data("prefix-list"),l=String.fromCharCode(n.which);if(i&&0==r.start)for(var f=0;f<i.length;f++)if(i[f].substr(0,1)==l){a.prefix(f);{a.prefix()}return a.caret({start:1,end:1}),void n.preventDefault()}if(i&&h.substr(0,e.length)!=e)return;if(r.start==r.end&&s.substr(r.start,1)==l)a.caret({start:r.start+1,end:r.start+1}),n.preventDefault();else{var g=r.end;g==r.start?g=s.length:g<s.length&&(g+=s.length),a.caret({start:s.length,end:g})}}}).on("keydown",function(e){var n=t(this).caret(),a=t(this).data("prefix");if(8==e.which||46==e.which){if(t(this).data("prefix-list"))return;8==e.which&&n.start<=a.length&&n.start==n.end?e.preventDefault():n.start<a.length&&n.start==n.end?e.preventDefault():n.start<a.length&&n.end==a.length?(t(this).caret({start:a.length,end:Math.max(n.end,a.length)}),e.preventDefault()):n.start<a.length&&t(this).caret({start:a.length,end:Math.max(n.end,a.length)})}else if(86==e.which&&e.ctrlKey){if(t(this).data("prefix-list"))return;if(n.start<a.length){var r=n.end;r<a.length&&(r+=a.length),t(this).caret({start:a.length,end:r})}}else 36==e.which&&e.ctrlKey&&(t(this).caret(e.shiftKey?{start:a.length,end:Math.max(n.start,a.length)}:{start:a.length,end:a.length}),e.preventDefault())}).on("paste",function(e){var n=t(this);setTimeout(function(){var t=n.data("prefix"),a=n.caret(),r=n.val().toUpperCase(),s=a.end;if(n.data("prefix-list"))for(var h=n.data("prefix-list"),i=0;i<h.length;i++)if(r.substr(0,h[i].length)==h[i]){t=h[i],n.data("prefix",t),n.trigger("prefixchange",[t,i]);break}r.substr(0,t.length)!=t&&(r=t+r,s+=t.length);for(var l=r.substr(t.length),f=l,i=t.length-1;i>=0;i--)if(l.substr(0,i+1)==t.substr(t.length-1-i)){f=f.substr(i+1);break}n.val(t+f),n.caret({start:s,end:s}),e.preventDefault()})}).on("change",function(){var e=t(this).data("prefix"),n=t(this).val();n.substr(0,e.length)!=e&&(n=e+n,t(this).val(n))}).on("blur",function(){var e=t(this).data("prefix-list"),n=t(this).data("prefix"),a=t(this).val();if(e&&a.substr(0,n.length)!=n){for(var r=0;r<e.length;r++)if(a.substr(0,e[r].length)==e[r])return void t(this).prefix(r);a=n+a,t(this).val(a)}}),this},t.fn.suffix=function(e,n){if(void 0===e)return this.data("suffix");var a=this.val(),r=this.data("suffix");return r&&a.substr(a.length-r.length)==r&&this.val(a.substr(0,a.length-r.length)),"object"==typeof e?(this.data("suffix-list",e),n=n||0,e=e[n]):"number"==typeof e&&this.data("suffix-list")?(n=e,e=this.data("suffix-list")[n]):this.data("suffix-list",!1),this.data("suffix",e),this.trigger("suffixchange",[e,n||0]),this.val().substr(this.val().length-e.length)!==e&&this.val(this.val()+e),this.on("keypress",function(n){var a=t(this),r=a.caret(),s=a.val(),h=a.data("suffix");if(r.end>s.length-h.length){var i=a.data("suffix-list"),l=String.fromCharCode(n.which);if(i&&r.start>=s.length-h.length)for(var f=0;f<i.length;f++)if(i[f].substr(0,1)==l)return a.val(s.substr(0,r.start)),a.suffix(f),a.caret({start:a.val().length,end:a.val().length}),void n.preventDefault();if(i&&s.substr(s.length-e.length)!=h)return;if(r.start==r.end&&h.substr(r.end-s.length+h.length,1)==String.fromCharCode(n.which))a.caret({start:r.end+1,end:r.end+1}),n.preventDefault();else{var g=r.start;g>s.length-h.length&&(g-=h.length),a.caret({start:g,end:s.length-h.length})}}else r.end==s.length-h.length&&r.start==r.end&&h.substr(r.end-s.length+h.length,1)==String.fromCharCode(n.which)&&(a.caret({start:r.end+1,end:r.end+1}),n.preventDefault())}).on("keydown",function(e){var n=t(this).caret(),a=t(this).val(),r=t(this).data("suffix");if(8==e.which||46==e.which){if(t(this).data("suffix-list"))return;46==e.which&&n.end>=a.length-r.length&&n.start==n.end?(t(this).caret({start:a.length-r.length,end:a.length-r.length}),e.preventDefault()):46==e.which&&n.end>=a.length-r.length&&n.start==n.end?e.preventDefault():n.start>a.length-r.length&&n.start==a.length-r.length?(t(this).caret({start:a.length-r.length,end:a.length-r.length}),e.preventDefault()):n.end>a.length-r.length&&t(this).caret({end:a.length-r.length,start:Math.min(n.start,a.length-r.length)})}else if(86==e.which&&e.ctrlKey){if(n.end>a.length-r.length){var s=n.start;s>a.length-r.length&&(s-=r.length),t(this).caret({start:s,end:a.length-r.length})}}else 35==e.which&&e.ctrlKey&&(t(this).caret(e.shiftKey?{start:Math.min(a.length-r.length,n.end),end:a.length-r.length}:{start:a.length-r.length,end:a.length-r.length}),e.preventDefault())}).on("paste",function(e){var n=this;setTimeout(function(){var a=t(n).data("suffix"),r=t(n).caret(),s=t(n).val(),h=r.end;if(n.data("suffix-list"))for(var i=n.data("suffix-list"),l=0;l<i.length;l++)if(s.substr(s.length-i[l].length)==i[l]){a=i[l],n.data("suffix",a),n.trigger("suffixchange",[a,l]);break}s.substr(s.length-a.length)!=a&&(s+=a);var f=s.substr(0,s.length-a.length),g=f;if(r.end>s.length-a.length){var h=r.start;h>s.length-a.length&&(h-=a.length),t(this).caret({start:h,end:s.length-a.length})}for(var l=a.length-1;l>=0;l--)if(f.substr(f.length-a.length+l)==a.substr(0,a.length-l)){g=g.substr(0,f.length-a.length+l);break}t(n).val(g+a),t(n).caret({start:h,end:h}),e.preventDefault()},1)}).on("change",function(){var e=t(this).data("suffix"),n=t(this).val();n.substr(n.length-e.length)!=e&&(n+=e,t(this).val(n))}).on("blur",function(){var e=t(this).data("suffix-list"),n=t(this).data("suffix"),a=t(this).val();if(e&&a.substr(a.length-n.length)!=n){for(var r=0;r<e.length;r++)if(a.substr(a.length-e[r].length)==e[r])return void t(this).suffix(r);a+=n,t(this).val(a)}}),this}}(jQuery);