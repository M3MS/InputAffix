// Created by Juan Camilo Osorio (JCOC611 - jcoc611.com).
// Version 0.1.1. (Beta).
// Consider giving back by sharing your own code!
// Licensed under the MIT License. 
// http://www.opensource.org/licenses/mit-license.php

// Includes jQuery Caret v1.02
// Slightly modified by JCOC611.
// Created by C. F., Wong, and also licensed
// under the MIT License. Find his project here:
// https://code.google.com/p/jcaret/ 

!function(t){if(!t)throw new Error("Input Affix: no jQuery found. Make sure window.jQuery exists.");t.fn.caret=function(t,e){var n,a,h=this[0];if("object"==typeof t&&"number"==typeof t.start&&"number"==typeof t.end)n=t.start,a=t.end;else if("number"==typeof t&&"number"==typeof e)n=t,a=e;else if("string"==typeof t)(n=h.value.indexOf(t))>-1?a=n+t.length:n=null;else if("[object RegExp]"===Object.prototype.toString.call(t)){var r=t.exec(h.value);null!=r&&(n=r.index,a=n+r[0].length)}if("undefined"!=typeof n){if(h.createTextRange){var l=h.createTextRange();l.collapse(!0),l.moveStart("character",n),l.moveEnd("character",a-n),l.select()}else h.selectionStart=n,h.selectionEnd=a;return h.focus(),this}if(document.selection){var s=document.selection;if("textarea"!=h.tagName.toLowerCase()){var i=this.val(),g=s.createRange().duplicate();g.moveEnd("character",i.length);var f=""==g.text?i.length:i.lastIndexOf(g.text);g=s.createRange().duplicate(),g.moveStart("character",-i.length);var d=g.text.length}else{var g=s.createRange(),c=g.duplicate();c.moveToElementText(h),c.setEndPoint("EndToEnd",g);var f=c.text.length-g.text.length,d=f+g.text.length}}else var f=h.selectionStart,d=h.selectionEnd;var u=h.value.substring(f,d);return{start:f,end:d,text:u,replace:function(t){return h.value.substring(0,f)+t+h.value.substring(d,h.value.length)}}},t.fn.prefix=function(e){return e?(this.data("prefix")&&this.val(this.val().substr(this.data("prefix").length,this.val().length-this.data("prefix").length)),this.data("prefix",e),0!=this.val().indexOf(e)&&this.val(e+this.val()),this.on("keypress",function(e){var n=t(this).caret(),a=t(this).data("prefix");if(n.start<a.length)if(n.start==n.end&&a.substr(n.start,1)==String.fromCharCode(e.which))t(this).caret({start:n.start+1,end:n.start+1}),e.preventDefault();else{var h=n.end;h==n.start?h=a.length:h<a.length&&(h+=a.length),t(this).caret({start:a.length,end:h})}}).on("keydown",function(e){var n=t(this).caret(),a=t(this).data("prefix");if(8==e.which||46==e.which)8==e.which&&n.start<=a.length&&n.start==n.end?e.preventDefault():n.start<a.length&&n.start==n.end?e.preventDefault():n.start<a.length&&n.end==a.length?(t(this).caret({start:a.length,end:Math.max(n.end,a.length)}),e.preventDefault()):n.start<a.length&&t(this).caret({start:a.length,end:Math.max(n.end,a.length)});else if(86==e.which&&e.ctrlKey){if(n.start<a.length){var h=n.end;h<a.length&&(h+=a.length),t(this).caret({start:a.length,end:h})}}else 36==e.which&&e.ctrlKey&&(t(this).caret(e.shiftKey?{start:a.length,end:Math.max(n.start,a.length)}:{start:a.length,end:a.length}),e.preventDefault())}).on("paste",function(e){var n=this;setTimeout(function(){var a=t(n).data("prefix"),h=t(n).caret(),r=t(n).val(),l=h.end;r.substr(0,a.length)!=a&&(r=a+r,l+=a.length);for(var s=r.substr(a.length),i=s,g=a.length-1;g>=0;g--)if(s.substr(0,g+1)==a.substr(a.length-1-g)){i=i.substr(g+1);break}t(n).val(a+i),t(n).caret({start:l,end:l}),e.preventDefault()})}),this):this.data("prefix")},t.fn.suffix=function(e){return e?(this.data("suffix")&&this.val(this.val().substr(0,this.val().length-this.data("suffix").length)),this.data("suffix",e),-1==this.val().indexOf(e,this.val().length-e.length)&&this.val(this.val()+e),this.on("keypress",function(e){var n=t(this).caret(),a=t(this).val(),h=t(this).data("suffix");if(n.end>a.length-h.length)if(n.start==n.end&&h.substr(n.end-a.length+h.length,1)==String.fromCharCode(e.which))t(this).caret({start:n.end+1,end:n.end+1}),e.preventDefault();else{var r=n.start;r>a.length-h.length&&(r-=h.length),t(this).caret({start:r,end:a.length-h.length})}else n.end==a.length-h.length&&n.start==n.end&&h.substr(n.end-a.length+h.length,1)==String.fromCharCode(e.which)&&(t(this).caret({start:n.end+1,end:n.end+1}),e.preventDefault())}).on("keydown",function(e){var n=t(this).caret(),a=t(this).val(),h=t(this).data("suffix");if(8==e.which||46==e.which)46==e.which&&n.end>=a.length-h.length&&n.start==n.end?(t(this).caret({start:a.length-h.length,end:a.length-h.length}),e.preventDefault()):46==e.which&&n.end>=a.length-h.length&&n.start==n.end?e.preventDefault():n.start>a.length-h.length&&n.start==a.length-h.length?(t(this).caret({start:a.length-h.length,end:a.length-h.length}),e.preventDefault()):n.end>a.length-h.length&&t(this).caret({end:a.length-h.length,start:Math.min(n.start,a.length-h.length)});else if(86==e.which&&e.ctrlKey){if(n.end>a.length-h.length){var r=n.start;r>a.length-h.length&&(r-=h.length),t(this).caret({start:r,end:a.length-h.length})}}else 35==e.which&&e.ctrlKey&&(t(this).caret(e.shiftKey?{start:Math.min(a.length-h.length,n.end),end:a.length-h.length}:{start:a.length-h.length,end:a.length-h.length}),e.preventDefault())}).on("paste",function(e){var n=this;setTimeout(function(){var a=t(n).data("suffix"),h=t(n).caret(),r=t(n).val(),l=h.end;r.substr(r.length-a.length)!=a&&(r+=a);var s=r.substr(0,r.length-a.length),i=s;if(h.end>r.length-a.length){var l=h.start;l>r.length-a.length&&(l-=a.length),t(this).caret({start:l,end:r.length-a.length})}for(var g=a.length-1;g>=0;g--)if(s.substr(s.length-a.length+g)==a.substr(0,a.length-g)){i=i.substr(0,s.length-a.length+g);break}t(n).val(i+a),t(n).caret({start:l,end:l}),e.preventDefault()},1)}),this):this.data("suffix")}}(jQuery);